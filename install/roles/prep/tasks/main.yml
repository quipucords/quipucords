---

- name: Check if install_offline flag is defined and true
  set_fact:
    install_flag_install_offline: true 
  when: 
    - install_offline is defined
    - install_offline == 'true'
    
- name: Set install_offline flag to false it was not defined or was not true
  set_fact:
    install_flag_install_offline: false 
  when: 
    - install_flag_install_offline is not defined

- name: Checking if server_version is defined when install_offline is true
  fail:
  when:
    - install_flag_install_offline and server_version is not defined

- name: Set operating system information
  set_fact:
    is_rhel_centos_6: "{{ ((ansible_distribution == 'RedHat') or (ansible_distribution == 'CentOS')) and (ansible_distribution_major_version == '6') }}"
    is_rhel7: "{{ (ansible_distribution == 'RedHat') and (ansible_distribution_major_version == '7') }}"
    is_centos_7: "{{ (ansible_distribution == 'CentOS') and (ansible_distribution_major_version == '7') }}"
    is_rhel_centos_7: "{{ ((ansible_distribution == 'RedHat') or (ansible_distribution == 'CentOS')) and (ansible_distribution_major_version == '7') }}"

- fail:
    msg: "This is not a supported system for installation. Must be RHEL 6/7, CentOS 6/7."
  when: not (is_rhel_centos_6 or is_rhel_centos_7)

- name: Get local package directory
  set_fact:
    pkg_install_dir: "{{ ansible_env['PKG_DIR'] | default(ansible_env['PWD'] + '/packages/') }}"
  when: pkg_install_dir is not defined

- name: Defaulting selinux_on to false
  set_fact:
    selinux_on: false

- name: Register selinux enabled command
  shell: selinuxenabled
  register: have_selinux_raw
  ignore_errors: yes

- name: Set selinux_on if selinux is enabled
  set_fact:
    selinux_on: true
  when:
    - have_selinux_raw.rc == 0

- name: Install server setting
  set_fact:
    install_server: "{{ install_server | bool | default(true) }}"
  when: install_server is defined

- name: Defaulting server install setting
  set_fact:
    install_server: true
  when: install_server is not defined

- name: Install CLI setting
  set_fact:
    install_cli: "{{ install_cli | bool | default(true) }}"
  when: install_cli is defined

- name: Defaulting CLI install setting
  set_fact:
    install_cli: true
  when: install_cli is not defined
